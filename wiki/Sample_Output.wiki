#labels Featured
= Introduction =

An example of check_httpd_limits.pl's screen output.

= Details =

A prefork MPM with MaxClients / ServerLimit of 40.

{{{
$ sudo ./check_httpd_limits.pl 
OK: Maximum HTTP procs (ServerLimit 40: 1487 MB) fits within the available RAM (ProjectFree 2441 MB).
}}}

A prefork MPM with MaxClients / ServerLimit of 100. Note the additional use of "-c" to specify which running httpd binary to check.

{{{
$ sudo ./check_httpd_limits.pl -c /usr/sbin/httpd
WARNING: Maximum HTTP procs (ServerLimit 100: 3807 MB) exceeds RAM (3939 MB), but still fits with available free swap (5984 MB).
}}}

A prefork MPM with MaxClients / ServerLimit of 500, which exceeds the available RAM and swap space.

{{{
$ sudo ./check_httpd_limits.pl 
ERROR: Maximum HTTP procs (ServerLimit 500: 19507 MB) exceeds available RAM (3939 MB) and free swap (5984 MB).
}}}

check_httpd_limits.pl can also be executed with "-v" to get detailed information on the httpd processes, configuration values, and the server's memory.

{{{
$ sudo ./check_httpd_limits.pl -v

Check Apache Httpd Process Limits (Version 1.0)

HttpdProcesses

 - PID 14479 (httpd)   :  17 MB /  7 MB shared [excluded from averages]
 - PID 27609 (httpd)   :  46 MB /  7 MB shared
 - PID 27614 (httpd)   :  48 MB /  6 MB shared
 - PID 27617 (httpd)   :  47 MB /  7 MB shared
 - PID 27620 (httpd)   :  45 MB /  7 MB shared
 - PID 27621 (httpd)   :  42 MB /  7 MB shared
 - PID 27623 (httpd)   :  47 MB /  7 MB shared
 - PID 27635 (httpd)   :  42 MB /  7 MB shared
 - PID 27637 (httpd)   :  46 MB /  7 MB shared
 - PID 27640 (httpd)   :  47 MB /  7 MB shared
 - PID 27642 (httpd)   :  46 MB /  7 MB shared

 - HttpdProcTot        :  394 MB [excludes shared]
 - HttpdProcAvg        :   39 MB [excludes shared]
 - HttpdProcShr        :    7 MB

HttpdConfig

 - MaxClients          : 40
 - MaxRequestsPerChild : 5000
 - MaxSpareServers     : 10
 - MinSpareServers     : 5
 - ServerLimit         : 40
 - StartServers        : 5

ServerMemory

 - Cached              :  1664 MB
 - MemFree             :   346 MB
 - MemTotal            :  3939 MB
 - SwapFree            :  5984 MB
 - SwapTotal           :  5984 MB

Summary

 - OtherProcs          :  1528 MB (MemTotal - Cached - MemFree - HttpdProcTot - HttpdProcShr)
 - ProjectFree         :  2411 MB (MemFree + Cached + HttpdProcTot + HttpdProcShr)
 - MaxClientsSize      :  1567 MB (HttpdProcAvg * MaxClients + HttpdProcShr)
 - AllProcsSize        :  3095 MB (OtherProcs + MaxClientsSize)

Possible Changes

   <IfModule prefork.c>
        MaxClients              62      # (40 -> 62) ServerLimit
        MaxRequestsPerChild   5000      # (no change) Default is 10000
        MaxSpareServers         10      # (no change) Default is 10
        MinSpareServers          5      # (no change) Default is 5
        ServerLimit             62      # (40 -> 62) (MemFree + Cached + HttpdProcTot + HttpdProcShr) / HttpdProcAvg
        StartServers             5      # (no change) Default is 5
   </IfModule>

Result

 - OK: Maximum HTTP procs (ServerLimit 40: 1567 MB) fits within the available RAM (ProjectFree 2411 MB).
}}}